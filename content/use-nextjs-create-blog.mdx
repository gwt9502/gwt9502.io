---
title: 'ä½¿ç”¨Nextjs+Tailwind+Contentlayeræ­å»ºåšå®¢'
publishedAt: '2023-11-15'
summary: 'ğŸ‰ ğŸ‰ å¿«é€Ÿåˆ›å»ºä¸ªäººåšå®¢ï¼Œæ”¯æŒmdxç¼–å†™ã€æœåŠ¡ç«¯æ¸²æŸ“ã€Githubè¯„è®ºã€ä¸»é¢˜åˆ‡æ¢ç­‰åŠŸèƒ½'
---

[Nextjs]: https://nextjs.org/
[Tailwind]: https://tailwindcss.com/
[Contentlayer]: https://contentlayer.dev/

[Nextjs][Nextjs] æ˜¯ä¸€ä¸ªåŸºäºReactçš„æœåŠ¡ç«¯æ¸²æŸ“æ¡†æ¶.   
[Tailwind][Tailwind] æ— éœ€ä¹¦å†™ CSSï¼Œå³å¯å¿«é€Ÿæ„å»ºç¾è§‚çš„ç½‘ç«™çš„ç»„ä»¶åº“.   
[Contentlayer][Contentlayer] å°†å†…å®¹è½¬æ¢æˆJSONå¹¶å¯¼å…¥åº”ç”¨ç¨‹åº.

## å‰æœŸå‡†å¤‡
- [Nodejs](https://nodejs.org/) >= 18.17.x

## åˆå§‹åŒ–é¡¹ç›®
```bash /No/4,6#v /Yes/1-3,5#v /my-app/#v
# ä½¿ç”¨å‘½ä»¤è¡Œ
npx create-next-app@latest
npx: 1 å®‰è£…æˆåŠŸï¼Œç”¨æ—¶ 5.568 ç§’
# é€‰æ‹©é…ç½®å¦‚ä¸‹
âœ” What is your project named? â€¦ my-app
âœ” Would you like to use TypeScript? â€¦ No / Yes
âœ” Would you like to use ESLint? â€¦ No / Yes
âœ” Would you like to use Tailwind CSS? â€¦ No / Yes
âœ” Would you like to use `src/` directory? â€¦ No / Yes
âœ” Would you like to use App Router? (recommended) â€¦ No / Yes
âœ” Would you like to customize the default import alias (@/*)? â€¦ No / Yes
```
`Nextjs`åº”ç”¨é¡µé¢å±‚æ¬¡å¦‚ä¸‹
- layout.js
- template.js
- error.js (React error boundary)
- loading.js (React suspense boundary)
- not-found.js (React error boundary)
- page.js

å¯¹åº”`React`æ¸²æŸ“è·¯ç”±å¦‚ä¸‹
<Image
  src={`/images/use-nextjs-create-blog/render-router.png`}
  width={1600}
  height={840}
/>
åµŒå¥—è·¯ç”±åªéœ€è¦åµŒå¥—çˆ¶åº”ç”¨é‡Œé¢å³å¯
<Image
  src={`/images/use-nextjs-create-blog/sub-router.png`}
  width={1600}
  height={840}
/>

## æ–°å»ºåšå®¢é¡µé¢
```tsx title="app/blog/[slug]/page.tsx"
type BlogSlugProps = {
  params: {
    slug: string
  }
}

export default function BlogSlug({ params }: BlogSlugProps) {
  return (
    <section>
      {params.slug}
    </section>
  )
}
```

## æ–°å»ºMDXæ–‡ä»¶
```mdx title="content/template.mdx"
---
title: 'template'
publishedAt: '2023-11-11'
summary: 'This is your first blog post.'
---

first blog
```

## è§£æMDX
ä½¿ç”¨[Contentlayer][Contentlayer]æ¥è§£æmdxæ–‡ä»¶ï¼Œæ–°å»º`contentlayer.config.ts`æ–‡ä»¶

å®‰è£…ä»¥ä¸‹ä¾èµ–

```sh
pnpm add contentlayer next-contentlayer @tailwindcss/typography reading-time remark-gfm rehype-slug rehype-autolink-headings rehype-pretty-code
```

- [@tailwindcss/typography](https://github.com/tailwindcss/typography): tailwindé£æ ¼çš„HTMLæ’ç‰ˆ
- [reading-time](https://github.com/ngryman/reading-time): è§£ææ–‡æ¡£å†…å®¹å­—ç¬¦æ•°é‡ï¼Œå¹¶è®¡ç®—é¢„è®¡é˜…è¯»æ—¶é—´
- [remark-gfm](https://github.com/remarkjs/remark-gfm): mdxè½¬æˆhtmlæ’ä»¶
- [rehype-slug](https://github.com/rehypejs/rehype-slug): h1-h6æ ‡ç­¾æ·»åŠ id
- [rehype-autolink-headings](https://github.com/rehypejs/rehype-autolink-headings): æ·»åŠ é”šç‚¹
- [rehype-pretty-code](https://rehype-pretty-code.netlify.app/): ç¾åŒ–ä»£ç 


```ts title="contentlayer.config.ts"
import { defineDocumentType, makeSource } from 'contentlayer/source-files'
import readingTime from 'reading-time'
import remarkGfm from 'remark-gfm'
import rehypeSlug from 'rehype-slug'
import rehypeAutolinkHeadings from 'rehype-autolink-headings'
import rehypePrettyCode from 'rehype-pretty-code'

export const Blog = defineDocumentType(() => ({
  name: 'Blog',
  filePathPattern: '**/*.mdx',
  contentType: 'mdx',
  // å®šä¹‰å…¥å£å­—æ®µ
  fields: {
    title: {
      type: 'string',
      required: true,
    },
    summary: {
      type: 'string',
      required: true,
    },
    publishedAt: {
      type: 'string',
      required: true,
    },
  },
  // å®šä¹‰é¢å¤–å‡ºå‚
  computedFields: {
    slug: {
      type: 'string',
      resolve: (doc) => doc._raw.flattenedPath,
    },
    readingTime: {
      type: 'nested',
      resolve: (doc) => readingTime(doc.body.code),
    },
  },
}))

export default makeSource({
  contentDirPath: 'content',
  documentTypes: [Blog],
  mdx: {
    remarkPlugins: [remarkGfm],
    rehypePlugins: [
      rehypeSlug,
      [
        rehypePrettyCode,
        {
          // ä»£ç ä¸»é¢˜ç±»å‹ https://unpkg.com/browse/shiki@0.14.2/themes/
          theme: 'one-dark-pro',
          // To apply a custom background instead of inheriting the background from the theme
          keepBackground: false,
        },
      ],
      [
        rehypeAutolinkHeadings,
        {
          properties: {
            // é”šç‚¹ç±»å
            className: ['anchor'],
          },
        },
      ],
    ],
  },
})
```

ä¿®æ”¹`next.config.js`æ–‡ä»¶
```js title="next.config.js" {1} /withContentlayer/2#v
const { withContentlayer } = require('next-contentlayer')

/** @type {import('next').NextConfig} */
const nextConfig = {}

module.exports = withContentlayer(nextConfig)
```
è¿è¡Œ `pnpm dev` ä¼šå‘ç°é¡¹ç›®ä¸­æ–°å¢ä¸€ä¸ª `.contentlayer` æ–‡ä»¶å¤¹ï¼Œæ‰“å¼€åå¯ä»¥æ‰¾åˆ°æˆ‘ä»¬ç¼–å†™çš„ `.mdx` æ–‡ä»¶å·²ç»è¢«è§£ææˆå¯¹åº”çš„ `.json` æ–‡ä»¶ã€‚ç”±äº `.contentlayer` è¯¥æ–‡ä»¶å¤¹æ˜¯è¿è¡Œçš„æ—¶å€™ç”Ÿæˆçš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æäº¤ä»£ç çš„æ—¶å€™å¿½ç•¥æ‰ï¼Œéœ€è¦åœ¨ `.gitignore` æ–‡ä»¶ä¸­å¢åŠ  `.contentlayer`

`tailwind.config.ts` æ–‡ä»¶éœ€è¦é…ç½® `@tailwindcss/typography` æ’ä»¶

```ts
import type { Config } from 'tailwindcss'
import typography from '@tailwindcss/typography'

const config: Config = {
  darkMode: 'class',
  content: [
    './app/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './content/**/*.mdx',
  ],
  theme: {
    extend: {},
  },
  plugins: [typography],
}
export default config
```
## è§£ææ•°æ®

æˆ‘ä»¬æ‰“å¼€ `app/page.tsx` æ–‡ä»¶ï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹

```tsx "app/page.tsx" {1-2, 7-22}
import { allBlogs } from 'contentlayer/generated'
import Link from 'next/link'

export default function Home() {
  return (
    <section>
      {allBlogs
        .sort((a, b) => {
          if (new Date(a.publishedAt) > new Date(b.publishedAt)) {
            return -1
          }
          return 1
        })
        .map((item) => (
          <Link
            key={item.slug}
            href={`/blog/${item.sulg}`}
            className='mb-5'
          >
            {item.title}
          </Link>
        ))}
    </section>
  )
}

é¡µé¢å±•ç¤ºå¦‚ä¸‹
```
<Image
  src={`/images/use-nextjs-create-blog/allBlogs.png`}
  width={1600}
  height={840}
  className='border'
/>

ä¿®æ”¹ `app/blog/[slug]/page.tsx` æ–‡ä»¶

```tsx
import { allBlogs } from 'contentlayer/generated'
import { notFound } from 'next/navigation'
import { useMDXComponent } from 'next-contentlayer/hooks'

type BlogSlugProps = {
  params: {
    slug: string
  }
}

export default function BlogSlug({ params }: BlogSlugProps) {
  const post = allBlogs.find((post) => post.slug === params.slug)
  if (!post) {
    notFound()
  }

  const Component = useMDXComponent(post.body.code)

  return (
    <section className="prose prose-stone">
      <Component />
    </section>
  )
}
```
é¡µé¢å±•ç¤ºå¦‚ä¸‹
<Image
  src={`/images/use-nextjs-create-blog/blog-slug.png`}
  width={1600}
  height={840}
  className='border'
/>

ç›®å‰ä¸ºæ­¢ï¼Œæ•´ä¸ªåšå®¢ç»“æ„ä½“ç³»æ­å»ºå®Œæˆï¼Œå¯ä»¥æ„‰å¿«çš„ç¼–å†™MDXæ–‡ä»¶æ¥å†™åšå®¢äº†